{extend name="common:base" /}
{block name="content"}
<link rel="stylesheet"  type="text/css"  href="__STATIC__/layui/build/css/layui.css"  >
<style type="text/css">
    .form .row dd{
        float: left;
        display: inline-block;
        width: calc(100% - 85px);
    }
  
    ul, ol, li {
        list-style: none;
    }
    .upload_area .post_imglist li {
        position: relative;
        float: left;
        padding: 0 10px 5px 0;
        line-height: 38px;
    }
    .upload_area .upload_btn {
        background: url(__STATIC__/layui/src/images/upload_btn.png) center no-repeat;
        background-size: 60px auto;
        float: left;
        overflow: hidden;
        position: relative;
        width: 60px;
        height: 60px;
    }
    .del {
        position: absolute;
        right: 0px;
        top: -10px;
        background: url(__STATIC__/layui/src/images/icon_del.png) no-repeat 15px 0;
        background-size: 20px auto;
        width: 40px;
        height: 20px;
        display: inline-block;
    }
    .upload_area .upload_btn input {
        opacity: 0;
        position: absolute;
        left: 0;
        top: 0;
        z-index: 10;
        overflow: hidden;
        height: 60px;
        width: 60px;
    }
    #imglist li img.wh60 {
        margin: 0 auto;
        display: block;
        width: 60px;
        height: 60px;
    }
    #back div{
      position: fixed;
      top: 50%;
      left: 50%;
      width: 30%;
      height: auto;
      margin-left: -20%;
  
    }
  </style>

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>{$meta_title}</h5>
                </div>
                <div class="ibox-content">
                    <form method="post" class="form-horizontal" action="">
                    <div id="gg">
                        
                        <div>库存数量:<div id='num'>0</div></div>
                        <div>商品价格:<div id='pri'>0</div></div>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{/block}

{block name="script"}
<script src="__STATIC__/layui/src/localResizeIMG2.js" type="text/javascript"></script>
<script type="text/javascript">
var goods_sku = '';
$.ajax({ 
    type: "get", 
    url: "http://api.zfwl.c3w.cc/goods/goodsdetail", 
    data:{'goods_id':18},
    async:false, 
    dataType: "json", 
    success: function(data){ 
        var spec = '';
        goods_sku = data.data.spec.goods_sku;
        $(data.data.spec.spec_attr).each(function(key,val){

            spec += '<div class="form-group spec">';
            spec += '<label class="col-sm-2 control-label">' + val.spec_name + '</label>';
            spec += '<div class="col-sm-9">';

                $(val.res).each(function(k,v){
                    spec += '<label style="margin-top:4px; margin-right:20px;">';
                    spec += '<input type="radio" value="'+v.attr_id+'" name="'+val.spec_id+'" />' + v.attr_name;
                    spec += '</label>';
                });

            spec += '</div>';
            spec += '</div>';
        });

        $('#gg').append(spec);
    } 
});

$('input[type="radio"]').on('click',function(){
    
    if( $(this).attr('checked') ){
        $(this).removeAttr('checked');
    }else{
        $(this).attr('checked','checked');
    }

    var spec_id = '';
    var attr_id = '';
    var str_sku = '';
    var arr = new Array;
    var arr = {};
    $('input[type=radio]:checked').each(function(key,val){
        spec_id = $(val).attr('name');
        attr_id = $(val).val();

        arr[spec_id] = parseInt( attr_id );
        // str_sku = spec_id + ':' + attr_id;
        // arr.push(str_sku);
        // str_sku += spec_id + ':' + attr_id + ',';
        // arr.push(attr_id);
    });
    // console.log( arr )

    $('input[type=radio]').attr('disabled','disabled');

    if( Object.keys(arr).length == 0 ){
        $('input[type=radio]').removeAttr('disabled');
        return;
    }

    $(goods_sku).each(function(key,val){
        $( eval('('+val.sku_attr+')') ).each(function(k,v){


            for(var kk in v){
                var flag = false;
                if(v[kk] == arr[kk]){
                    flag = true;    
                }else{
                    if( flag && arr[kk] == undefined ){
                        flag = true;
                    }else{
                        flag = false;
                    }
                }

                if(flag){
                    for(var kkk in v){
                        $('input[value='+v[kkk]+']').removeAttr('disabled');
                    }
                }

                    // console.log( arr[kk] )
            }
            // if(flag){
            //     $('input[value='+v[kk]+']').removeAttr('disabled');
            //     flag = false;
            // }
            // console.log( v )

        });
    });
    // console.log( arr )

    // for(var key in arr){
        
    // }

    // console.log( goods_sku )

    // str_sku = str_sku.substr(0, str_sku.length - 1); 


    // $('input[type=radio]').attr('disabled','disabled');
    // $(goods_sku).each(function(key,val){
    //     if( val.sku_attr.match(str_sku) ){
    //         $( eval('('+val.sku_attr+')') ).each(function(k,v){
    //             for(var kk in v){
    //                 if( arr.indexOf(v[kk]) ){
    //                     $('input[value='+v[kk]+']').removeAttr('disabled');
    //                     $('#num').html( val.inventory )
    //                     $('#pri').html( val.price )
    //                 }
    //             }
    //         })
    //     }
    // });
});








</script>
{/block}